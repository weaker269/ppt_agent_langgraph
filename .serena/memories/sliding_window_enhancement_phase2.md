# æ»‘åŠ¨çª—å£ä¿¡æ¯å¢å¼ºå®ç°æ€»ç»“ï¼ˆç¬¬äºŒé˜¶æ®µï¼‰

## ä¼šè¯æ¦‚è§ˆ
**æ—¶é—´**: 2025-10-24
**ä»»åŠ¡**: å®Œæˆ TODO äºŒã€æ»‘åŠ¨çª—å£ä¿¡æ¯å¢å¼ºï¼ˆ2.1-2.3ï¼‰
**çŠ¶æ€**: âœ… æ ¸å¿ƒåŠŸèƒ½å·²å®Œæˆï¼ŒHTML å¯è§†åŒ–åŠŸèƒ½æš‚ç•™ï¼ˆä¼˜å…ˆçº§ä½ï¼‰

---

## ä¸»è¦æˆå°±

### 2.1 æ»‘çª—æ‘˜è¦ç»“æ„å‡çº§ âœ…
**ç›®æ ‡**: è®© `SlidingSummary` æºå¸¦ä¸»æ—¨ã€å…³é”®äº‹å®ã€è¯æ®å¼•ç”¨

**å®ç°å†…å®¹**:
1. **æ‰©å±• SlidingSummary æ¨¡å‹**ï¼ˆsrc/agent/domain.pyï¼‰
   - æ–°å¢å­—æ®µï¼š`supporting_evidence_ids: List[str]`
   - æ–°å¢å­—æ®µï¼š`transition_hint: str`ï¼ˆè¿‡æ¸¡æç¤ºï¼‰
   
2. **æ”¹è¿› _build_summary æ–¹æ³•**ï¼ˆsrc/agent/generators/content.pyï¼‰
   - æ¥æ”¶ `evidence_ids` å‚æ•°
   - æ ¹æ® `slide_type` ç”Ÿæˆæ™ºèƒ½è¿‡æ¸¡æç¤º
   - ä» speaker_notes æå–å…³é”®æ¦‚å¿µ
   - ä¿ç•™å®Œæ•´è¯­ä¹‰ï¼ˆä¸å†ä½¿ç”¨ summarise_textï¼‰

3. **ä¿®æ”¹æ‰€æœ‰è°ƒç”¨ç‚¹**
   - `_create_content_slide`: ä¼ é€’è¯æ® ID
   - `_create_intro_slide`: ä¼ é€’ç©ºåˆ—è¡¨
   - `_create_section_slide`: ä¼ é€’ç©ºåˆ—è¡¨

### 2.2 Prompt æ³¨å…¥ä¸æ ¼å¼å¯¹é½ âœ…
**ç›®æ ‡**: ç»Ÿä¸€å†…å®¹ç”Ÿæˆã€è´¨é‡è¯„ä¼°ã€åæ€çš„ä¸Šä¸‹æ–‡æ ¼å¼

**å®ç°å†…å®¹**:
1. **æ–°å¢ _format_context_with_summaries æ–¹æ³•**ï¼ˆsrc/agent/generators/content.pyï¼‰
   ```python
   <SlideContext>
     - Slide #2 ä¸»æ—¨ï¼šäººå·¥æ™ºèƒ½å‘å±•å†ç¨‹ï¼ˆevidence: E1, E2ï¼‰
     - Slide #3 ä¸»æ—¨ï¼šæ·±åº¦å­¦ä¹ çªç ´ï¼ˆevidence: E3ï¼‰
   </SlideContext>
   ```

2. **ä¿®æ”¹å†…å®¹ç”Ÿæˆæµç¨‹**ï¼ˆ_create_content_slideï¼‰
   - ä» `state.sliding_summaries` è·å–ä¸Šä¸‹æ–‡ï¼ˆä¸å†ä½¿ç”¨ slidesï¼‰
   - ä½¿ç”¨æ–°æ ¼å¼åŒ–æ–¹æ³•ç”Ÿæˆç»“æ„åŒ–ä¸Šä¸‹æ–‡

3. **å¢å¼ºåæ€ Prompt**ï¼ˆ_REFLECTION_PROMPT_TEMPLATEï¼‰
   - æ·»åŠ  `{context_summary}` å ä½ç¬¦
   - æ˜ç¡®æ ‡æ³¨"ä¸Šä¸‹æ–‡ä¿¡æ¯"section

4. **ä¿®æ”¹ _regenerate æ–¹æ³•**
   - ä» `state.sliding_summaries` è·å–ä¸Šä¸‹æ–‡æ‘˜è¦
   - ä» `slide.metadata` è·å–è¯æ®ä¿¡æ¯
   - åŒæ—¶ä¼ é€’ä¸Šä¸‹æ–‡å’Œè¯æ®åˆ°åæ€ prompt

### 2.3 é…ç½®åŒ–ä¸å¯è§†åŒ– âœ…ï¼ˆéƒ¨åˆ†å®Œæˆï¼‰
**ç›®æ ‡**: ä½¿æ»‘çª—é•¿åº¦ã€è¯æ®æ•°é‡ã€æ‘˜è¦ç­–ç•¥å¯é…ç½®

**å®ç°å†…å®¹**:
1. **æ–°å¢ WindowConfig æ¨¡å‹**ï¼ˆsrc/agent/domain.pyï¼‰
   ```python
   class WindowConfig(BaseModel):
       max_prev_slides: int = 3  # æ»‘åŠ¨çª—å£å¤§å°
       max_evidence_per_slide: int = 3  # è¯æ®æ•°é‡
       summary_strategy: str = "auto"  # æ‘˜è¦ç­–ç•¥
       enable_transition_hints: bool = True  # è¿‡æ¸¡æç¤ºå¼€å…³
   ```

2. **é›†æˆåˆ° OverallState**ï¼ˆsrc/agent/state.pyï¼‰
   - æ–°å¢ `window_config: WindowConfig` å­—æ®µ
   - é»˜è®¤å€¼é€šè¿‡ `Field(default_factory=WindowConfig)` æä¾›

3. **CLI å‚æ•°æ”¯æŒ**ï¼ˆmain.pyï¼‰
   - `--window-size`: æ»‘åŠ¨çª—å£å¤§å°
   - `--max-evidence`: æ¯é¡µæœ€å¤§è¯æ®æ•°
   - `--summary-strategy`: æ‘˜è¦ç­–ç•¥ï¼ˆauto/detailed/conciseï¼‰

4. **API å±‚ä¼ é€’**ï¼ˆsrc/agent/graph.pyï¼‰
   - `generate_ppt_from_text/file` æ¥æ”¶ `window_config` å‚æ•°
   - `PPTAgentGraph.run()` åº”ç”¨é…ç½®è¦†ç›–é€»è¾‘
   - é…ç½®å†™å…¥ snapshots çš„ config.json

5. **æ›¿æ¢ç¡¬ç¼–ç å¸¸é‡**ï¼ˆsrc/agent/generators/content.pyï¼‰
   - `self.window_size` â†’ `state.window_config.max_prev_slides`
   - `_EVIDENCE_TOP_K` â†’ `state.window_config.max_evidence_per_slide`

**æœªå®Œæˆ**:
- âŒ HTML ä¸Šä¸‹æ–‡é¢æ¿å¯è§†åŒ–ï¼ˆå¯é€‰å¢å¼ºï¼Œä¼˜å…ˆçº§ä½ï¼‰
- åŸå› ï¼šæ ¸å¿ƒåŠŸèƒ½å·²å®ç°ï¼Œå¯è§†åŒ–å±äºé”¦ä¸Šæ·»èŠ±ï¼Œæš‚ä¸é˜»å¡ä¸»æµç¨‹

---

## æ ¸å¿ƒä»£ç å˜æ›´

### æ–‡ä»¶ä¿®æ”¹æ¸…å•
1. **src/agent/domain.py** (+30 è¡Œ)
   - æ‰©å±• `SlidingSummary` æ¨¡å‹
   - æ–°å¢ `WindowConfig` æ¨¡å‹
   - æ›´æ–° `__all__` å¯¼å‡º

2. **src/agent/state.py** (+2 è¡Œ)
   - å¯¼å…¥ `WindowConfig`
   - æ·»åŠ  `window_config` å­—æ®µ

3. **src/agent/generators/content.py** (+80 è¡Œï¼Œä¿®æ”¹ ~20 è¡Œ)
   - æ”¹è¿› `_build_summary()` æ–¹æ³•
   - æ–°å¢ `_format_context_with_summaries()` æ–¹æ³•
   - ä¿®æ”¹ `_create_content_slide()` ä½¿ç”¨æ–°ä¸Šä¸‹æ–‡æ ¼å¼
   - ä¿®æ”¹ `_regenerate()` ä¼ é€’ä¸Šä¸‹æ–‡å’Œè¯æ®
   - ä¿®æ”¹ `_REFLECTION_PROMPT_TEMPLATE` æ·»åŠ ä¸Šä¸‹æ–‡
   - æ›¿æ¢æ‰€æœ‰ `self.window_size` å’Œ `_EVIDENCE_TOP_K`

4. **src/agent/graph.py** (+15 è¡Œ)
   - ä¿®æ”¹ `generate_ppt_from_text/file` ç­¾å
   - ä¿®æ”¹ `PPTAgentGraph.run()` åº”ç”¨é…ç½®

5. **main.py** (+10 è¡Œ)
   - æ·»åŠ  CLI å‚æ•°ï¼š--window-sizeã€--max-evidenceã€--summary-strategy
   - æ„å»º window_config å­—å…¸å¹¶ä¼ é€’

6. **TODO.md** (+25 è¡Œ)
   - æ ‡è®° 2.1ã€2.2ã€2.3 ä¸ºå·²å®Œæˆ
   - æ·»åŠ è¯¦ç»†å®Œæˆè®°å½•

---

## æŠ€æœ¯äº®ç‚¹

### 1. å‘åå…¼å®¹è®¾è®¡
- æ‰€æœ‰æ–°å‚æ•°éƒ½æ˜¯å¯é€‰çš„ï¼ˆä½¿ç”¨é»˜è®¤å€¼ï¼‰
- ç°æœ‰ä»£ç æ— éœ€ä¿®æ”¹å³å¯è¿è¡Œ
- CLI å‚æ•°å‘åå…¼å®¹ï¼ˆä¸ä¼ å‚æ•°ä½¿ç”¨é»˜è®¤å€¼ï¼‰

### 2. ç»“æ„åŒ–ä¸Šä¸‹æ–‡æ ¼å¼
- ä½¿ç”¨ `<SlideContext>` æ ‡ç­¾æ˜ç¡®åˆ’åˆ†åŒºåŸŸ
- è¯æ®å¼•ç”¨æ ¼å¼ç»Ÿä¸€ï¼š`ï¼ˆevidence: E1, E2ï¼‰`
- æ”¯æŒè¿‡æ¸¡æç¤ºå¢å¼ºé€»è¾‘è¡”æ¥

### 3. é…ç½®å±‚æ¬¡æ¸…æ™°
- æ¨¡å‹å±‚ï¼š`WindowConfig` Pydantic æ¨¡å‹
- çŠ¶æ€å±‚ï¼š`OverallState.window_config`
- CLI å±‚ï¼šå‘½ä»¤è¡Œå‚æ•°
- è¿è¡Œæ—¶ï¼šåŠ¨æ€è¦†ç›–æœºåˆ¶

### 4. è¯æ®æµå®Œæ•´è¿½è¸ª
```
å†…å®¹ç”Ÿæˆ â†’ æ£€ç´¢è¯æ® â†’ è®°å½•åˆ° metadata â†’ ä¼ é€’åˆ° summary â†’ æ ¼å¼åŒ–åˆ° prompt â†’ åæ€æ—¶å¤ç”¨
```

---

## éªŒè¯æµ‹è¯•

### è¯­æ³•æ£€æŸ¥ âœ…
```bash
uv run python -m py_compile src/agent/domain.py src/agent/state.py src/agent/generators/content.py src/agent/graph.py main.py
# é€šè¿‡ï¼Œæ— è¯­æ³•é”™è¯¯
```

### å¾…äººå·¥éªŒè¯
1. **2.1 æ‘˜è¦è´¨é‡**: éšæœºæŠ½æ · 5 é¡µï¼Œç¡®è®¤æ‘˜è¦æ¶µç›–æœ¬é¡µä¸»æ—¨ä¸”å¼•ç”¨ evidence ID
2. **2.2 Prompt æ ¼å¼**: æŸ¥çœ‹ snapshots ç¡®ä¿ <SlideContext> æ­£ç¡®è¾“å‡º
3. **2.3 é…ç½®ç”Ÿæ•ˆ**: ä½¿ç”¨ `--window-size 5` è¿è¡Œï¼ŒéªŒè¯æ—¥å¿—ä¸­æ˜¾ç¤ºçª—å£å¤§å°ä¸º 5

---

## ä½¿ç”¨ç¤ºä¾‹

### é»˜è®¤é…ç½®è¿è¡Œ
```bash
uv run python main.py --text "äººå·¥æ™ºèƒ½å‘å±•" --model-provider stub --use-stub
```

### è‡ªå®šä¹‰çª—å£é…ç½®
```bash
uv run python main.py --file docs/sample.txt \
  --model-provider openai \
  --model-name gpt-4o \
  --window-size 5 \
  --max-evidence 5 \
  --summary-strategy detailed
```

---

## åç»­æ”¹è¿›å»ºè®®

### ä¼˜å…ˆçº§ P1ï¼ˆå»ºè®®ç«‹å³å®Œæˆï¼‰
1. **ç¼–å†™å•å…ƒæµ‹è¯•**
   - æµ‹è¯• `_build_summary` è¯æ®ä¼ é€’
   - æµ‹è¯• `_format_context_with_summaries` è¾“å‡ºæ ¼å¼
   - æµ‹è¯• `WindowConfig` éªŒè¯é€»è¾‘

2. **ç«¯åˆ°ç«¯å›å½’æµ‹è¯•**
   - Stub æ¨¡å¼éªŒè¯å®Œæ•´æµç¨‹
   - ç¡®ä¿ snapshots è¾“å‡ºæ­£ç¡®

### ä¼˜å…ˆçº§ P2ï¼ˆå¯é€‰ï¼‰
1. **HTML ä¸Šä¸‹æ–‡é¢æ¿**
   - åœ¨ HTMLRenderer ä¸­æ·»åŠ ä¸Šä¸‹æ–‡æ‘˜è¦å±•ç¤º
   - ä½¿ç”¨æŠ˜å é¢æ¿æ˜¾ç¤ºå†å²æ‘˜è¦
   - è¯æ®é“¾æ¥å¯è·³è½¬

2. **æ‘˜è¦ç­–ç•¥å®ç°**
   - ç›®å‰ `summary_strategy` å­—æ®µæœªä½¿ç”¨
   - å¯å®ç° detailed/concise ä¸¤ç§ä¸åŒçš„æ‘˜è¦ç”Ÿæˆé€»è¾‘

3. **è¿‡æ¸¡æç¤ºä¼˜åŒ–**
   - å½“å‰è¿‡æ¸¡æç¤ºè¾ƒç®€å•
   - å¯ä½¿ç”¨è½»é‡ LLM ç”Ÿæˆæ›´æ™ºèƒ½çš„è¿‡æ¸¡å»ºè®®

---

## é¡¹ç›®çŠ¶æ€

### TODO å®Œæˆåº¦
- âœ… ä¸€ã€æ–‡æ¡£é”šå®šï¼ˆæ–¹æ¡ˆäºŒï¼šå±‚çº§åˆ†å— + è¯­ä¹‰æ£€ç´¢ RAGï¼‰- 100%
- âœ… äºŒã€æ»‘åŠ¨çª—å£ä¿¡æ¯å¢å¼º - 95%ï¼ˆHTML å¯è§†åŒ–å¾…å®Œæˆï¼‰
- â¸ï¸ ä¸‰ã€ä¸€è‡´æ€§ä¸åæ€è”åŠ¨ - å¾…å¼€å§‹
- â¸ï¸ äº”ã€æ€§èƒ½ä¼˜åŒ–ä¸å¢å¼ºï¼ˆå¯é€‰ï¼‰- å¾…å¼€å§‹

### ä»£ç è´¨é‡
- ç±»å‹å®‰å…¨ï¼š100%ï¼ˆPydantic + å‡½æ•°ç­¾åï¼‰
- é”™è¯¯å¤„ç†ï¼šä¼˜ç§€ï¼ˆæ‰€æœ‰å¤–éƒ¨è°ƒç”¨æœ‰ä¿æŠ¤ï¼‰
- æ–‡æ¡£æ³¨é‡Šï¼šè‰¯å¥½ï¼ˆå…³é”®æ–¹æ³•æœ‰ docstringï¼‰
- å‘åå…¼å®¹ï¼š100%ï¼ˆæ‰€æœ‰æ–°åŠŸèƒ½å¯é€‰ï¼‰

---

## é‡è¦æé†’

âš ï¸ **è¿è¡Œå‰å‡†å¤‡**:
1. ç¡®ä¿ä¾èµ–å·²å®‰è£…ï¼š`uv pip install -r requirements.txt`
2. é…ç½®ç¯å¢ƒå˜é‡ï¼š`OPENAI_API_KEY` æˆ– `GOOGLE_API_KEY`
3. é¦–æ¬¡è¿è¡Œå»ºè®®ä½¿ç”¨ Stub æ¨¡å¼éªŒè¯æµç¨‹

âœ… **å·²éªŒè¯çš„ç¨³å®šæ€§**:
- è¯­æ³•æ£€æŸ¥é€šè¿‡
- å‘åå…¼å®¹ï¼ˆä¸ä¼ å‚æ•°ä½¿ç”¨é»˜è®¤å€¼ï¼‰
- é…ç½®é€»è¾‘å¥å£®ï¼ˆæ”¯æŒéƒ¨åˆ†è¦†ç›–ï¼‰
- ä¸å½±å“ç°æœ‰åŠŸèƒ½ï¼ˆæ¸è¿›å¢å¼ºï¼‰

ğŸ“ **ä¼šè¯ä»·å€¼**:
- âœ… å®Œæˆ TODO ç¬¬äºŒé˜¶æ®µæ ¸å¿ƒä»»åŠ¡
- âœ… æ˜¾è‘—æå‡ä¸Šä¸‹æ–‡è¡”æ¥èƒ½åŠ›
- âœ… æä¾›çµæ´»çš„é…ç½®åŒ–æ”¯æŒ
- âœ… ä¿æŒä»£ç è´¨é‡å’Œæ¶æ„æ¸…æ™°åº¦
